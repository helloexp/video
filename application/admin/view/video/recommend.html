{include file="public:head" /}

<style>
	.btn-container { margin-bottom: 10px; }
    .layui-table-cell .layui-form-checkbox[lay-skin=primary] { top: 5px; }
</style>

<div class="layui-fluid">
	<div class="layui-card">
		<div class="layui-card-header">特别推荐</div>
		<div class="layui-card-body">
			<div class="btn-container">
				<button class="layui-btn layui-btn-normal" onclick="pop()">添加推荐</button>
				<button class="layui-btn layui-btn-danger layui-btn-normal" onclick="pop()">批量删除</button>
			</div>
			<table id="table" lay-filter="table"></table>
		</div>
	</div>
</div>

<script>
    layui.use('table', function() {
        var table = layui.table;

        table.render({
            elem: "#table",
            url: "{:url('recommend')}",
            page: true,
            done: function(res) {
            },
            cols: [[
                {type: 'checkbox', fixed: 'left'},
                {field: 'id', title: 'ID', width: 70, align: 'center'},
                {field: 'title', title: '视频名称', width: 140, align: 'center'},
                {field: 'time', title: '视频长度', width: 90, align: 'center'},
                {field: 'type', title: '视频类型', width: 90, align: 'center'},
                {field: 'fabulous', title: '喜欢', width: 80, align: 'center'},
                {field: 'step_on', title: '不喜欢', width: 80, align: 'center'},
                {field: 'watch_count', title: '观看次数', width: 100, align: 'center', sort: true},
                {field: 'create_time', title: '上传时间', width: 120, align: 'center'},
                {title: '操作', width: 80, align: 'center', templet: '#operation', fixed: 'right'}
            ]]
        });

        // 监听工具栏
        table.on('tool(table)', function(o) {
            var d   = o.data,
                lEv = o.event,
                tr  = o.tr

            if (lEv == 'detail') pop(d);
            if (lEv == 'deleted') deleted(d);
        })
    });

    // 弹出层
    var pop = function(data) {
        var html  = '<div class="layui-form">'
        html += '<div class="layui-form-item">'
        html += '<label class="layui-form-label">视频ID</label>'
        html += '<div class="layui-input-block">'
        html += '<input type="text" name="id" placeholder="输入视频id多个按逗号隔开" class="layui-input">'
        html += '</div>'
        html += '</div>'
        html += '</div>'

        layer.open({
            title: "推荐输入",
            content: html,
            yes: function(res) {
                // 判断输入框是否为空
                if ($('[name=id]').val().length == 0) {

                    layer.alert('不能存在空的输入框', { icon: 5 });
                    return ;
                }

                layer.load(2);
                $.post(u, d, function(res) {
                    // 清除弹出层
                    layer.closeAll()

                    if (res.code == 0) {
                        layer.msg(title+'成功', {icon: 6, time: 1500}, function() {
                            window.location.reload()
                        })
                        return ;
                    }

                    layer.msg(title+'失败', {icon: 5, time: 1500})
                })
            }
        });

        // 设置数据
        if (data != null) {
            $('[name=type]').val(data.type)
            $('[name=sort]').val(data.sort)
        }
    }

    // 删除
    var deleted = function(data) {
        layer.confirm('确认删除该数据?', function() {
            layer.closeAll()

            $.ajax({
                url : "{:url('delete')}",
                type : "POST",
                data : {
                    'id' : data.id,
                },
                dataType : 'json' ,
                success : function(res){
                    if(res.code == 0){
                        layer.msg("删除成功", {icon: 6}, function() {
                            location.reload()
                        });

                    } else{
                        layer.msg("删除失败", {icon: 5});
                    }
                }
            });
        });
    }
</script>

<script type="text/html" id="operation">
	<a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="deleted">删除</a>
</script>
